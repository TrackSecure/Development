<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard 2º | Analista</title>
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
    <link rel="stylesheet" href="dash2_analista_gustavo.css">
    <script src="../js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<!-- <body onload="validarSessao('Analista de Sistemas', '../dashboard_inicial_gerente.html')"> -->

<body onload="mostrar_nome(), atualizarTotalServidores(), atualizarTotalAlertas(), atualizarGrafico()">
    <div class="dashboard">
        <header>
            <div class="perfil">
                <div class="texto">
                    <span id="user"></span>
                </div>
            </div>
            <div class="botao">
                <div class="container">
                    <button onclick="window.location = '../dashboard_inicial_analista.html'">Início</button>
                    <button onclick="sair()">Sair</button>
                </div>
            </div>
        </header>
    </div>

    <div class="paginaDash">
        <div class="menu">
            <div class="container">
                <p class="Servidor">Selecione uma Linha!</p>
                <select class="select" id="select_linha">
                    <option value="0" selected>Todos</option>
                    <option value="1">Linha Amarela</option>
                    <option value="2">Linha Vermelha</option>
                    <option value="3">Linha Verde</option>
                </select>
                <p class="Servidor">Selecione um Servidor!</p>
                <select class="select" id="select_servidor">
                    <option value="0" selected>Todos</option>
                    <option value="1">Servidor 1</option>
                    <option value="2">Servidor 2</option>
                    <option value="3">Servidor 3</option>
                </select>
            </div>
            <div class="logo">
                <img src="logo.png" alt="logo" class="logo-img">
                <a href="index.html" class="logo-txt"><span>Track</span>Secure</a>
            </div>
        </div>

        <div class="caixaGrafico">
            <div class="titulos_kpi">
                <h2>Quantidade de Servidores Cadastrados</h2>
                <h2>Quantidade de Alertas</h2>
                <h2>Total de Processos Acima do Esperado</h2>
            </div>
            <div class="kpis">
                <div class="cardT">
                    <h3 id="total-servidores"></h3>
                </div>
                <div class="cardT">
                    <h3 id="total-alertas"></h3>
                </div>
                <div class="cardT">
                    <h3 style="color: red;">10</h3>
                </div>
            </div>
            <div class="detalhes">
                <div class="ver_detalhes">
                    <button class="botao_detalhes" onclick="window.location = './dash3_analista_vitor'">Ver
                        Detalhes</button>
                </div>
            </div>
            <div class="centro">
                <div class="esquerda">
                    <h2>Servidores / Linhas</h2>
                    <div class="servidores">
                        <div class="caixa-esquerda">
                            <button>TESTE</button>
                            <button>TESTE</button>
                            <button>TESTE</button>
                            <button>TESTE</button>
                            <button>TESTE</button>
                            <button>TESTE</button>
                        </div>
                    </div>
                </div>
                <div class="direita">
                    <div class="cima">
                        <select class="select_componente" id="select_componente">
                            <option value="CPU" selected>CPU</option>
                            <option value="RAM">RAM</option>
                        </select>
                        <button class="botao_detalhes" onclick="window.location = './dash1_analista_patroni.html'">Ver
                            Detalhes</button>
                    </div>
                    <div id="chart"></div>
                </div>
            </div>
        </div>
    </div>


</body>

</html>


<script>

function atualizarTotalAlertas() {
        // Obtém o ID da empresa do sessionStorage (certifique-se de que está definido)
        const fkEmpresa = sessionStorage.getItem('ID_EMPRESA');
        
        // Faz a requisição para a API
        fetch("/analistaGustavo/qtdAlertas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ idEmpresa: fkEmpresa })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao obter o total de alertas');
            }
            return response.json();
        })
        .then(data => {
            div = document.getElementById("total-alertas");
            // Atualiza o conteúdo do HTML com o total de servidores
            document.getElementById("total-alertas").textContent = data.total_alertas;

            if(data.total_alertas >= 1) {
                div.style.color = "red";
            }
        })
        .catch(error => {
            console.error("Erro ao buscar o total de alertas:", error);
        });
    }

    function atualizarTotalServidores() {
        // Obtém o ID da empresa do sessionStorage (certifique-se de que está definido)
        const fkEmpresa = sessionStorage.getItem('ID_EMPRESA');
        
        // Faz a requisição para a API
        fetch("/analistaGustavo/qtdServidores", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ idEmpresa: fkEmpresa })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao obter o total de servidores');
            }
            return response.json();
        })
        .then(data => {
            // Atualiza o conteúdo do HTML com o total de servidores
            document.getElementById("total-servidores").textContent = data.total_servidores;
        })
        .catch(error => {
            console.error("Erro ao buscar o total de servidores:", error);
        });
    }

    
    function mostrar_nome() {
        var nome = sessionStorage.NOME_USUARIO;
        var cargo = sessionStorage.CARGO;
        user.innerHTML = `Olá, ${nome} (${cargo})`;
    }

    var select_componente = document.getElementById('select_componente');

    // Função para atualizar o gráfico
    function atualizarGrafico() {
        var componente = select_componente.value; // Pega o valor selecionado

        var options = {
            chart: {
                type: 'line',
                height: 350,
                width: 550,
            },
            series: [{
                name: componente, // Define o nome da série com o valor do select
                data: [10, 20, 15, 30, 40, 35, 50] // Dados do gráfico
            }],
            xaxis: {
                categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul'],
            },
            title: {
                text: componente, // Define o título do gráfico com o valor do select
                align: 'center'
            }
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
    }

    // Atualiza o gráfico quando o select muda
    select_componente.addEventListener('change', function () {
        document.querySelector("#chart").innerHTML = ""; // Limpa o gráfico anterior
        atualizarGrafico();
    });

</script>